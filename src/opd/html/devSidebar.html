<button id="benchmark-button" class="create full-width row">
  <span class="material-symbols-outlined">
    speed
  </span>
  Run Benchmark
  <span class="material-symbols-outlined">
    speed
  </span>
</button>
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<script>
  $(function() {
    console.log('test');
    $('#benchmark-button').click(requestBenchmark);
  });

  function throwError(error) {
    throw new Error(error.message);
  }
  
  async function requestBenchmark() {
    let iterationCount = askForIterationCount();
    console.log('iterationCount', iterationCount);
    let result = confirm('Are you sure you want to run the benchmark ' + iterationCount + ' times?');
    if (result == false) {
      console.log('Benchmark Stopped');
      return;
    }
    while(iterationCount > 0) {
      let results = await runBenchmarkTests();
      console.debug('results', results);
      iterationCount--;
    }
    toastr.success('Benchmark complete');
  }

  function askForIterationCount() {
    var iterationCount = prompt('How many iterations would you like to run?');
    if (typeof iterationCount !== 'number') {
      iterationCount = parseInt(iterationCount);
      if (iterationCount == NaN) {
        alert('Invalid input. Please enter a number.');
        return askForIterationCount();
      }
    }
    if (iterationCount <= 0) {
      alert('Invalid input. Please enter a positive number.');
      return askForIterationCount();
    }
    return iterationCount;
  }

  async function runBenchmarkTests() {
    await jumpToProposal();
    const results = {};

    let start = performance.now();
    await jumpToProject();
    let end = performance.now();
    results['jumpToProjects'] = end - start;
    console.debug('jumpToProjects', results['jumpToProjects']);
    toastr.success('jumpToProjects', results['jumpToProjects']);

    try {
      await selectEmptyProject();
      results['getInitiativeEmptyProject'] = await new Promise(resolve => setTimeout(async function() {
        start = performance.now();
        await refreshSidebar();
        end = performance.now();
        resolve(end - start);
      }, 100));
      toastr.success('getInitiativeEmptyProject', results['getInitiativeEmptyProject']);
      console.debug('getInitiativeEmptyProject', results['getInitiativeEmptyProject']);
    } catch (error) {
      console.error('Error selecting empty project: ' + error.message);
      alert('Error selecting empty project: ' + error.message);
      return;
    }

    try {
      await selectNoDocsProject();
      results['getInitiativeNoDocsProject'] = await new Promise(resolve => setTimeout(async function() {
        start = performance.now();
        await refreshSidebar();
        end = performance.now();
        resolve(end - start);
      }, 100));
      toastr.success('getInitiativeNoDocsProject', results['getInitiativeNoDocsProject']);
      console.debug('getInitiativeNoDocsProject', results['getInitiativeNoDocsProject']);
    } catch (error) {
      console.error('Error selecting no docs project: ' + error.message);
      alert('Error selecting no docs project: ' + error.message);
      return;
    }

    start = performance.now();
    await generateJob();
    end = performance.now();
    results['generateJobExstingClient'] = end - start;
    toastr.success('generateJobExstingClient', results['generateJobExstingClient']);
    console.debug('generateJobExstingClient', results['generateJobExstingClient']);

    try {
      await deleteProjectFiles();
      await deleteClientFiles();
      //TODO it crashed somewhere in here, fix it.
      //TODO link all git pushes to my email so they are recorded
      results['generateJobNewClient'] = await new Promise(resolve => setTimeout(async function() {
        start = performance.now();
        await generateJob();
        end = performance.now();
        resolve(end - start);
      }, 100));
    } catch (error) {
      console.error('Error generating job from new client: ' + error.message);
      alert('Error generating job from new client: ' + error.message);
      return;
    }

    try {
      await deleteProjectFiles();
      start = performance.now();
      await jumpToProposal();
      end = performance.now();
      results['jumpToProposals'] = end - start;
      console.debug('jumpToProposals', results['jumpToProposals']);
      toastr.success('jumpToProposals', results['jumpToProposals']);
    } catch (error) {
      console.error('Error jumping to proposals: ' + error.message);
      alert('Error jumping to proposals: ' + error.message);
      return;
    }

    try {
      await selectEmptyProposal();
      results['getInitiativeNewProposal'] = await new Promise(resolve => setTimeout(async function() {
        start = performance.now();
        await refreshSidebar();
        end = performance.now();
        resolve(end - start);
      }, 100));
      toastr.success('getInitiativeNewProposal', results['getInitiativeNewProposal']);
      console.debug('getInitiativeNewProposal', results['getInitiativeNewProposal']);
    } catch (error) {
      console.error('Error selecting new proposal: ' + error.message);
      alert('Error selecting new proposal: ' + error.message);
      return;
    }

    try {
      await selectNoDocsProposal();
      results['getInitiativeNoDocsProposal'] = await new Promise(resolve => setTimeout(async function() {
        start = performance.now();
        await refreshSidebar();
        end = performance.now();
        resolve(end - start);
      }, 100));
      toastr.success('getInitiativeNoDocsProposal', results['getInitiativeNoDocsProposal']);
      console.debug('getInitiativeNoDocsProposal', results['getInitiativeNoDocsProposal']);
    } catch (error) {
      console.error('Error selecting no docs proposal: ' + error.message);
      alert('Error selecting no docs proposal: ' + error.message);
      return;
    }

    start = performance.now();
    await generateProposal();
    end = performance.now();
    results['generateProposalExstingClient'] = end - start;
    toastr.success('generateProposalExstingClient', results['generateProposalExstingClient']);
    console.debug('generateProposalExstingClient', results['generateProposalExstingClient']);

    try {
      await deleteProposalFiles();
      await deleteClientFiles();
      results['generateProposalNewClient'] = await new Promise(resolve => setTimeout(async function() {
        start = performance.now();
        await generateProposal();
        end = performance.now();
        resolve(end - start);
      }, 100));
    } catch (error) {
      console.error('Error generating proposal from new client: ' + error.message);
      alert('Error generating proposal from new client: ' + error.message);
      return;
    }

    start = performance.now();
    await acceptProposal();
    end = performance.now();
    results['acceptProposal'] = end - start;
    toastr.success('acceptProposal', results['acceptProposal']);
    console.debug('acceptProposal', results['acceptProposal']);

    try {
      await deleteProjectFiles();
    } catch {
      console.error('Error deleting project files: ' + error.message);
      alert('Error deleting project files: ' + error.message);
      return;
    }

    start = performance.now();
    await openChangelog();
    end = performance.now();
    results['openChangelog'] = end - start;
    toastr.success('openChangelog', results['openChangelog']);
    console.debug('openChangelog', results['openChangelog']);

    return results;
  }

  async function selectEmptyProject() {
    await googleScript(()=>{}, 'selectEmptyProject', [], throwError);
  }

  async function selectEmptyProposal() {
    await googleScript(()=>{}, 'selectEmptyProposal', [], throwError);
  }

  async function selectFullProject() {
    await googleScript(()=>{}, 'selectFullProject', [], throwError);
  }

  async function selectFullProposal() {
    await googleScript(()=>{}, 'selectFullProposal', [], throwError);
 }

  async function selectNoDocsProject() {
    await googleScript(()=>{}, 'selectNoDocsProject', [], throwError);
  }

  async function selectNoDocsProposal() {
    await googleScript(()=>{}, 'selectNoDocsProposal', [], throwError);
  }

  async function selectNewProjectFromExistingClient() {
    await googleScript(()=>{}, 'selectNewProjectFromExistingClient', [], throwError);
  }

  async function deleteProject() {
    await googleScript(()=>{}, 'deleteProject', [], throwError);
  }

  async function deleteClientFiles() {
    await googleScript(()=>{}, 'deleteClientFiles', [], throwError);
  }

  async function selectNewProposal() {
    await googleScript(()=>{}, 'selectNewProposal', [], throwError);
  }

  async function deleteProposalFiles() {
    await googleScript(()=>{}, 'deleteProposalFiles', [], throwError);
  }

  async function deleteProjectFiles() {
    await googleScript(()=>{}, 'deleteProjectFiles', [], throwError);
  }
</script>