<button id="benchmark-button" class="create full-width row">
  <span class="material-symbols-outlined">
    speed
  </span>
  Run Benchmark
  <span class="material-symbols-outlined">
    speed
  </span>
</button>
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<script>
  $(function() {
    $('#benchmark-button').click(requestBenchmark);
  });
  
  function requestBenchmark() {
    let iterationCount = askForIterationCount();
    console.log('iterationCount', iterationCount);
    google.script.run
      .withSuccessHandler(async function(result) {
        if (result == false) {
          console.log('Benchmark Stopped');
          return;
        }
        console.log('Begining Benchmark');
        while(iterationCount > 0) {
          let results = await runBenchmarkTests();
          console.debug('results', results);
          iterationCount--;
        }
        toastr.success('Benchmark complete');
      })
      .withFailureHandler(function(error) {
        console.error('Benchmark failed: ' + error.message);
        toastr.alert('Benchmark failed: ' + error.message);
      })
      .requestBenchmark(iterationCount);
  }

  function askForIterationCount() {
    var iterationCount = prompt('How many iterations would you like to run?');
    if (typeof iterationCount !== 'number') {
      iterationCount = parseInt(iterationCount);
      if (iterationCount == NaN) {
        alert('Invalid input. Please enter a number.');
        return askForIterationCount();
      }
    }
    if (iterationCount <= 0) {
      alert('Invalid input. Please enter a positive number.');
      return askForIterationCount();
    }
    return iterationCount;
  }

  async function runBenchmarkTests() {
    const results = {};
    let start = performance.now();
    await jumpToProposal();
    let end = performance.now();
    results['jumpToProjects'] = end - start;
    console.debug('jumpToProjects', results['jumpToProjects']);
    toastr.success('jumpToProjects', results['jumpToProjects']);
    start = performance.now();
    await jumpToProject();
    end = performance.now();
    results['jumpToProposals'] = end - start;
    console.debug('jumpToProposals', results['jumpToProposals']);
    toastr.success('jumpToProposals', results['jumpToProposals']);

    return results;

    try {
      selectEmptyProject();
      await new Promise(resolve => setTimeout(async function() {
        start = performance.now();
        getInitiative();
        end = await new Promise(resolve => {
          let intervalId = setInterval(function() {
            if (!isLoading) {
              let end = performance.now();
              clearInterval(intervalId);
              resolve(end);
            }
          }, 5);
        });
        results['getInitiativeEmptyProject'] = end - start;
        toastr.success('getInitiativeEmptyProject', results['getInitiativeEmptyProject']);
        console.debug('getInitiativeEmptyProject', results['getInitiativeEmptyProject']);
      }, 100));
    } catch (error) {
      console.error('Error selecting empty project: ' + error.message);
      alert('Error selecting empty project: ' + error.message);
      return;
    }
    
    try {
      selectEmptyProposal();
      await setTimeout(function() {
        start = performance.now();
        getInitiative();
        end = performance.now();
      }, 100);
      results['getInitiativeEmptyProposal'] = end - start;
      console.debug('getInitiativeEmptyProposal', results['getInitiativeEmptyProposal']);
    } catch (error) {
      console.error('Error selecting empty proposal: ' + error.message);
      alert('Error selecting empty proposal: ' + error.message);
      return;
    }

    return results;
    
    try {
      selectFullProject();
      setTimeout(async function() {
        start = performance.now();
        getInitiative();
        end = await new Promise(resolve => {
          let intervalId = setInterval(function() {
            if (!isLoading) {
              let end = performance.now();
              clearInterval(intervalId);
              resolve(end);
            }
          }, 5);
        });
      }, 100);
      console.debug('getInitiativeFullProject', results['getInitiativeFullProject']);
      toastr.success('getInitiativeFullProject', results['getInitiativeFullProject']);
    } catch (error) {
      console.error('Error selecting full project: ' + error.message);
      alert('Error selecting full project: ' + error.message);
      return;
    }

    try {
      selectFullProposal();
      setTimeout(function() {
        start = performance.now();
        getInitiative();
        end = performance.now();
      }, 100);  
      results['getInitiativeFullProposal'] = end - start;
      console.debug('getInitiativeFullProposal', results['getInitiativeFullProposal']);
    } catch (error) {
      console.error('Error selecting full proposal: ' + error.message);
      alert('Error selecting full proposal: ' + error.message);
      return;
    }
    
    try {
      selectNoDocsProject();
      setTimeout(function() {
        start = performance.now();
        getInitiative();
        end = performance.now();
      }, 100);
      results['getInitiativeNoDocsProject'] = end - start;
      console.debug('getInitiativeNoDocsProject', results['getInitiativeNoDocsProject']);
    } catch (error) {
      console.error('Error selecting no docs project: ' + error.message);
      alert('Error selecting no docs project: ' + error.message);
      return;
    }

    try {
      selectNoDocsProposal();
      setTimeout(function() {
        start = performance.now();
        getInitiative();
        end = performance.now();
      }, 100);
      results['getInitiativeNoDocsProposal'] = end - start;
      console.debug('getInitiativeNoDocsProposal', results['getInitiativeNoDocsProposal']);
    } catch (error) {
      console.error('Error selecting no docs proposal: ' + error.message);
      alert('Error selecting no docs proposal: ' + error.message);
      return;
    }

    try {
      selectNewProjectFromExistingClient();
      setTimeout(function() {
        start = performance.now();
        generateJob();
        end = performance.now();
      }, 100);
      results['generateProjectFromExistingClient'] = end - start;
      console.debug('generateProjectFromExistingClient', results['generateProjectFromExistingClient']);
    } catch (error) {
      console.error('Error generating project from existing client: ' + error.message);
      alert('Error generating project from existing client: ' + error.message);
      return;
    }

    try {
      deleteProject();
      deleteClient();
      setTimeout(function() {
        start = performance.now();
        generateJob();
        end = performance.now();
      }, 100);
      results['generateProjectFromNewClient'] = end - start;
      console.debug('generateProjectFromNewClient', results['generateProjectFromNewClient']);
    } catch (error) {
      console.error('Error generating project from new client: ' + error.message);
      alert('Error generating project from new client: ' + error.message);
      return;
    }

    try {
      deleteProject();
      selectNewProposal();
      setTimeout(function() {
        start = performance.now();
        generateProposal();
        end = performance.now();
      }, 100);
      results['generateProposalFromExistingClient'] = end - start;
      console.debug('generateProposalFromExistingClient', results['generateProposalFromExistingClient']);
    } catch (error) {
      console.error('Error generating proposal from existing client: ' + error.message);
      alert('Error generating proposal from existing client: ' + error.message);
      return;
    }

    try {
      deleteProposal();
      deleteClient();
      setTimeout(function() {
        start = performance.now();
        generateProposal();
        end = performance.now();
      }, 100);
      results['generateProposalFromNewClient'] = end - start;
      console.debug('generateProposalFromNewClient', results['generateProposalFromNewClient']);
    } catch (error) {
      console.error('Error generating proposal from new client: ' + error.message);
      alert('Error generating proposal from new client: ' + error.message);
      return;
    }

    try {
      setTimeout(function() {
        start = performance.now();
        acceptProposal();
        end = performance.now();
      }, 100);
      results['acceptProposal'] = end - start;
      console.debug('acceptProposal', results['acceptProposal']);
      deleteProject();
    } catch (error) {
      console.error('Error accepting proposal: ' + error.message);
      alert('Error accepting proposal: ' + error.message);
      return;
    }

    try {
      setTimeout(function() {
        start = performance.now();
        openChangelog();
        end = performance.now();
      }, 100);
      results['openChangelog'] = end - start;
      console.debug('openChangelog', results['openChangelog']);
    } catch (error) {
      console.error('Error opening changelog: ' + error.message);
      alert('Error opening changelog: ' + error.message);
      return;
    }
    return results;
  }

  function selectEmptyProject() {
    googleScript(function() {

    })
    google.script.run
      .withFailureHandler(function(error) {
        throw new Error(error.message);
      })
      .selectEmptyProject();
  }

  function selectEmptyProposal() {
    google.script.run
      .withFailureHandler(function(error) {
        throw new Error(error.message);
      })
      .selectEmptyProposal();
  }

  function selectFullProject() {
    google.script.run
      .withFailureHandler(function(error) {
        throw new Error(error.message);
      })
      .selectFullProject();
  }

  function selectFullProposal() {
    google.script.run
      .withFailureHandler(function(error) {
        throw new Error(error.message);
      })
      .selectFullProposal();
  }

  function selectNoDocsProject() {
    google.script.run
      .withFailureHandler(function(error) {
        throw new Error(error.message);
      })
      .selectNoDocsProject();
  }

  function selectNoDocsProposal() {
    google.script.run
      .withFailureHandler(function(error) {
        throw new Error(error.message);
      })
      .selectNoDocsProposal();
  }

  function selectNewProjectFromExistingClient() {
    google.script.run
      .withFailureHandler(function(error) {
        throw new Error(error.message);
      })
      .selectNewProjectFromExistingClient();
  }

  function deleteProject() {
    google.script.run
      .withFailureHandler(function(error) {
        throw new Error(error.message);
      })
      .deleteProject();
  }

  function deleteClient() {
    google.script.run
      .withFailureHandler(function(error) {
        throw new Error(error.message);
      })
      .deleteClient();
  }

  function selectNewProposal() {
    google.script.run
      .withFailureHandler(function(error) {
        throw new Error(error.message);
      })
      .selectNewProposal();
  }

  function deleteProposal() {
    google.script.run
      .withFailureHandler(function(error) {
        throw new Error(error.message);
      })
      .deleteProposal();
  }
</script>